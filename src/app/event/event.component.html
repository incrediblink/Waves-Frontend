<div class="full-container">
    <div class="content-left event-header" [style.background-image]="'url(' + (event.HeaderImage ? event.HeaderImage.ImageUrl : Global.cdn + 'default.png') + ')'">
        <a class="header-image-source" [href]="event.HeaderImage ? event.HeaderImage.SourceUrl : 'https://zh.wikipedia.org/wiki/%E5%A4%A9%E6%B3%A8%E5%AE%9A'" target="_blank"
            tooltipPlacement="left"
            [tooltip]="'图片来自' + (event.HeaderImage ? event.HeaderImage.ImageSource : '贾樟柯《天注定》')">
            <i class="fa fa-info-circle" aria-hidden="true"></i>
        </a>
        <div class="header-info">
            <h1 class="font-title header-title">{{event.Title}}</h1>
            <div class="tag-set">
                <a class="tag" *ngFor="let tag of tagCollection" [routerLink]="['/tag/' + tag.Title]">{{tag.Title}}</a>
            </div>
        </div>
    </div>
    <div class="content-right font-content">
        <div class="timeline">
            <h4 style="margin-bottom: 1rem">事件相关新闻</h4>
            <div class="card card-block news" *ngFor="let news of collections; let i = index">
                <small class="text-muted">{{news.Source}}</small>
                <a href="{{news.Url}}" [name]="news._id" class="news-title no-decoration" target="_blank"><h4 class="card-title font-title">{{news.Title}}</h4></a>
                <p *ngIf="news.Abstract" class="card-text font-content">{{news.Abstract}}</p>
                <div class="news-bottom">
                    <a class="text-muted font-content">{{(news.Time).toLocaleString()}}</a>
                    <div class="button-bottom">
                        <a href="javascript:void(0);" (click)="twitterHref(news.Title, event._id, event.Title)" tooltipPlacement="bottom" 
                            tooltip="分享至 Twitter" class="fa fa-twitter no-decoration button-share icon-twitter" aria-hidden="true"></a>
                        <a href="javascript:void(0);" (click)="weiboHref(news.Title, event._id, event.Title)" tooltipPlacement="bottom" 
                            tooltip="分享至微博" class="fa fa-weibo no-decoration button-share icon-weibo" aria-hidden="true"></a>
                        <a href="{{news.Url}}" tooltipPlacement="bottom" tooltip="跳转至原文" 
                            class="fa fa-external-link no-decoration button-share icon-source" aria-hidden="true" target="_blank"></a>
                        <a href="javascript:void(0);" [hidden]="!isAdmin" (click)="removeNews(news._id, i)" tooltipPlacement="bottom" 
                            tooltip="移除该新闻" class="fa fa-trash no-decoration button-share icon-trash" aria-hidden="true"></a>
                    </div>
                </div>
            </div>
        </div>
        <div class="follow">
            <button type="button" (click)="subscribeModal.show()" class="btn btn-info btn-sm button-follow"
                tooltipPlacement="bottom" [tooltip]="event.Subscriber.length != 0 ? '已有 ' + event.Subscriber.length + ' 人关注该事件' : '尚未有人关注该事件'">关注</button>
            <button type="button" (click)="addNewsModal.show()" class="btn btn-primary btn-sm button-follow">为该事件添加新闻</button>
        </div>
        <div bsModal #subscribeModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="subscribeModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content font-content">
                    <div class="modal-header font-title">
                        <button type="button" class="close" (click)="subscribeModal.hide()" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                        <h4 class="modal-title">关注事件</h4>
                    </div>
                    <div class="modal-body">
                        <div class="subscribe-option-set">
                            <h4 style="margin-bottom: 1rem">请选择在什么情况下提醒你事件动态</h4>
                            <div class="btn-group subscribe-option" dropdown keyboardNav="true">
                                <button id="simple-btn-keyboard-nav" type="button" class="btn btn-primary" dropdownToggle>
                                    {{subscribe.situation}} <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu" dropdownMenu role="menu" aria-labelledby="simple-btn-keyboard-nav">
                                    <li role="menuitem" *ngFor="let option of Global.subscribeMode"><a class="dropdown-item" (click)="subscribe.select.situation(option)" href="javascript:void(0);">{{option.Title}}</a></li>
                                </ul>
                            </div>
                            <div class="btn-group subscribe-option" dropdown keyboardNav="true">
                                <button id="simple-btn-keyboard-nav" type="button" class="btn btn-primary" dropdownToggle [disabled]="subscribe.situation == '在 …… 的情况下'">
                                    {{subscribe.time}} <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu" dropdownMenu role="menu" aria-labelledby="simple-btn-keyboard-nav">
                                    <li role="menuitem" *ngFor="let option of subscribeMode"><a class="dropdown-item" (click)="subscribe.select.time(option)" href="javascript:void(0);">{{option.Title}}</a></li>
                                </ul>
                            </div>
                            <div class="btn-group subscribe-option" dropdown keyboardNav="true">
                                <button id="simple-btn-keyboard-nav" type="button" class="btn btn-primary" dropdownToggle>
                                    {{subscribe.method}} <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu" dropdownMenu role="menu" aria-labelledby="simple-btn-keyboard-nav">
                                    <li role="menuitem" *ngFor="let option of Global.notificationType">
                                        <div *ngIf="option.Permission.LoginRequired" style="position:relative;left:100rem">
                                            <a class="dropdown-item" (click)="option.Permission.LoginRequired ? 1 : subscribe.select.notificationType(option)" 
                                                href="javascript:void(0);" tooltipPlacement="right" [tooltip]="option.Permission.message"
                                                style="position:relative;right:100rem" [class.disabled]="option.Permission.LoginRequired">
                                                {{option.Title}}
                                            </a>
                                        </div>
                                        <a *ngIf="!option.Permission.LoginRequired" class="dropdown-item" (click)="subscribe.select.notificationType(option)" 
                                            href="javascript:void(0);">
                                            {{option.Title}}
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div [hidden]="subscribe.notificationType != 'Email'" class="subscribe-option">
                            <div class="form-group row">
                                <label for="email" class="col-xs-3 col-form-label">邮箱</label>
                                <div class="col-xs-9">
                                    <input [(ngModel)]="subscribe.address" class="form-control" [class.ng-invalid-control]="!Validation.Email.test(subscribe.address)"
                                        type="email" required placeholder="contact@langchao.land">
                                </div>
                            </div>
                        </div>
                        <div class="submit">
                            <button *ngFor="let button of Global.notificationType"
                                (click)="subscribeEvent(subscribeModal)" type="button" class="btn btn-primary" 
                                [hidden]="subscribe.notificationType != button.Mode"
                                [disabled]="!(subscribe.mode && subscribe.notificationType && subscribe.address && Validation[button.Mode].test(subscribe.address))">
                                关注该事件
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div bsModal #addNewsModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="addNewsModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content font-content">
                    <div class="modal-header font-title">
                        <button type="button" class="close" (click)="addNewsModal.hide()" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                        <h4 class="modal-title">添加新闻至该事件</h4>
                    </div>
                    <div class="modal-body">
                        <div class="form-group row">
                            <label for="newsUrl" class="col-xs-3 col-form-label">新闻</label>
                            <div class="col-xs-9">
                                <input [(ngModel)]="add" class="form-control" 
                                    [class.ng-invalid-control]="!(Validation.Url.test(add) || Validation.EventID.test(add))" 
                                    type="text" placeholder="新闻链接或代号" required>
                            </div>
                        </div>
                        <div class="submit">
                            <button (click)="addNews(addNewsModal)" type="button" class="btn btn-primary"
                                [disabled]="!(Validation.Url.test(add) || Validation.EventID.test(add))">
                                添加
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--<a class="button-setting"><i class="fa fa-cog"></i></a>-->
    </div>
</div>
